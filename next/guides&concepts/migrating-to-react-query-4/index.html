<!doctype html>
<html class="docs-version-current" lang="cn" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=0.86,maximum-scale=3,minimum-scale=0.86">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<meta content="React Query,TanStack Query,React,Query,TanStack Queryä¸­æ–‡,React Queryä¸­æ–‡,æ•°æ®åŒæ­¥" name="Keywords">
<title data-rh="true">è¿ç§»åˆ°React Query 4 | React Query ä¸­æ–‡æ–‡æ¡£</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cangsdarm.github.io/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-4"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="è¿ç§»åˆ°React Query 4 | React Query ä¸­æ–‡æ–‡æ¡£"><meta data-rh="true" name="description" content="ç ´åæ€§æ›´æ”¹"><meta data-rh="true" property="og:description" content="ç ´åæ€§æ›´æ”¹"><link data-rh="true" rel="icon" href="/react-query-web-i18n/img/favicon.png"><link data-rh="true" rel="canonical" href="https://cangsdarm.github.io/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-4"><link data-rh="true" rel="alternate" href="https://cangsdarm.github.io/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-4" hreflang="cn"><link data-rh="true" rel="alternate" href="https://cangsdarm.github.io/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-4" hreflang="x-default"><link rel="stylesheet" href="/react-query-web-i18n/assets/css/styles.c138480c.css">
<link rel="preload" href="/react-query-web-i18n/assets/js/runtime~main.911b33c8.js" as="script">
<link rel="preload" href="/react-query-web-i18n/assets/js/main.7cbfae2a.js" as="script">
<meta name="google-site-verification" content="Qa9IAETG_rUMzy5ZXHjOxjAK7awElBSO6p_XVLGzuZk">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EGJ5SQ3RN3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EGJ5SQ3RN3")</script>
</head>
<body class="navigation-with-keyboard" itemscope="" itemtype="http://schema.org/Organization">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#f1563a;color:#000000" role="banner"><div class="announcementBarContent_KsVm">v4çš„æ–‡æ¡£ç¿»è¯‘ä¸­(<span style="font-weight:bold;">"å‡†å¤‡å¼€å§‹"åŠ"é€‚é…å™¨"å·²ç»ç¿»è¯‘å®Œæ¯•!</span>å…¶ä»–è¯·æŸ¥çœ‹<a href="/react-query-web-i18n/next/tags/ç¿»è¯‘å®Œæˆ">"ç¿»è¯‘å®Œæˆ"</a>çš„tag!)ï¼Œç°åœ¨ç¨³å®šçš„æ˜¯v3ç‰ˆæœ¬çš„æ–‡æ¡£</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/react-query-web-i18n/"><div class="navbar__logo"><img src="/react-query-web-i18n/img/logo-v4.png" alt="logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/react-query-web-i18n/img/logo-v4.png" alt="logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TanStack Query ä¸­æ–‡æ–‡æ¡£</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/react-query-web-i18n/">æ–‡æ¡£</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/react-query-web-i18n/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-4">Next</a></li><li><a class="dropdown__link" href="/react-query-web-i18n/">v3</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">å®˜æ–¹èµ„æºï¼ˆè‹±æ–‡ï¼‰</a><ul class="dropdown__menu"><li><a href="https://tanstack.com/query/v4/docs/examples/react/basic" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>ç¤ºä¾‹<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://learn.tanstack.com/p/react-query-essentials" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>å­¦ä¹ <svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/TanStack/query" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Github<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><a href="https://github.com/cangSDARM/react-query-web-i18n" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO menuWithAnnouncementBar_x19h"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">å‡†å¤‡å¼€å§‹</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/">æ¦‚è§ˆ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/installation">å®‰è£…</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/quick-start">å¿«é€Ÿå…¥é—¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/devtools">å¼€å‘è°ƒè¯•å·¥å…·</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/videos&amp;talks">è§†é¢‘æ•™ç¨‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/comparison">æ¯”è¾ƒ | React Query vs SWR vs Apollo vs RTK Query vs React Router</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/typescript">TypeScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/graphql">GraphQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/getstarted/react-native">React Native</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">é€‚é…å™¨</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/adapters/react-query">React Query</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/adapters/svelte-query">Svelte Query (Coming Soon)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/adapters/solid-query">Solid Query (Coming Soon)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/adapters/vue-query">Vue Query (Coming Soon)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">æŒ‡å—&amp;æ¦‚å¿µ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/important-defaults">é‡è¦çš„é»˜è®¤é…ç½® Important Defaults</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/queries">æŸ¥è¯¢ queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/query-keys">æŸ¥è¯¢çš„é”®å€¼ query-keys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/query-functions">æŸ¥è¯¢å‡½æ•° query-functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/network-mode">ç½‘ç»œæ¨¡å¼ network-mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/parallel-queries">å¹¶è¡ŒæŸ¥è¯¢ parallel-queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/dependent-queries">æœ‰ä¾èµ–çš„æŸ¥è¯¢ Dependent Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/background-fetching-indicators">åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ Background Fetching Indicators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/window-focus-refetching">çª—å£ç„¦ç‚¹å½±å“çš„æ•°æ®åˆ·æ–° window-focus-refetching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/disabling-queries">ç¦ç”¨/æš‚åœæŸ¥è¯¢ Disabling/Pausing Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/query-retries">æŸ¥è¯¢é‡è¯• query-retries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/paginated-queries">åˆ†é¡µ/æ»åæŸ¥è¯¢ paginated-queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/infinite-queries">æ— é™æŸ¥è¯¢ Infinite Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/placeholder-query-data">æŸ¥è¯¢æ•°æ®å ä½ç¬¦ placeholder-query-data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/initial-query-data">åˆå§‹åŒ–çš„æŸ¥è¯¢æ•°æ® Initial Query Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/prefetching">é¢„å–æ•°æ® prefetching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/mutations">ä¿®æ”¹ mutations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/query-invalidation">æŸ¥è¯¢å¤±æ•ˆ query-invalidation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/invalidation-from-mutations">ä¿®æ”¹å¯¼è‡´çš„å¤±æ•ˆ Invalidation From Mutations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/updates-from-mutation-responses">å“åº”æ›´æ–°çš„æ•°æ® updates-from-mutation-responses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/optimistic-updates">ä¹è§‚æ›´æ–° optimistic-updates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/query-cancellation">æŸ¥è¯¢å–æ¶ˆ query-cancellation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/scroll-restoration">æ»šåŠ¨æ¢å¤ scroll-restoration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/filters">è¿‡æ»¤å™¨ Filters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/ssr">æœåŠ¡ç«¯æ¸²æŸ“ SSR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/caching">ç¼“å­˜ Caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/default-query-function">é»˜è®¤çš„æŸ¥è¯¢å‡½æ•° Default Query Fn</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/suspense">Suspense</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/custom-logger">è‡ªå®šä¹‰æ—¥å¿—è®°å½•å™¨ Custom Logger</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/testing">æµ‹è¯• testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/does-this-replace-client-state">React Queryæ˜¯å¦ä¼š/å¯ä»¥å–ä»£Reduxï¼ŒMobXæˆ–å…¶ä»–å…¨å±€çŠ¶æ€ç®¡ç†å™¨ï¼Ÿ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-3">è¿ç§»åˆ°React Query 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-4">è¿ç§»åˆ°React Query 4</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">èŒƒä¾‹</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://react-query.tanstack.com/examples/simple" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>å®˜æ–¹ç¤ºä¾‹<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://search.bilibili.com/all?keyword=react-query" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>å›½å†…å†…å®¹(Bilibili)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">ç¤¾åŒºæ•™ç¨‹/åšå®¢</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://react-query.tanstack.com/community/tkdodos-blog" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>TkDodo&#x27;s Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://juejin.cn/post/6937833844837974053" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>å…¥é—¨æ•™ç¨‹(æ˜é‡‘)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">æ’ä»¶</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/plugins/broadcastQueryClient">broadcastQueryClient (Experimental)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/plugins/createAsyncStoragePersister">createAsyncStoragePersister</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/plugins/createSyncStoragePersister">createSyncStoragePersister</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/plugins/persistQueryClient">persistQueryClient</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">APIå‚è€ƒ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://react-query.tanstack.com/reference/useQuery" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>ç­‰å¾…ç¿»è¯‘...<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/react-query-web-i18n/next/doc_template">å¯¹è´¡çŒ®è€…å†™çš„æ–‡æ¡£è§„èŒƒ</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->React Query ä¸­æ–‡æ–‡æ¡£<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/react-query-web-i18n/">latest version</a></b> (<!-- -->v3<!-- -->).</div></div><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/react-query-web-i18n/">ğŸ </a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">æŒ‡å—&amp;æ¦‚å¿µ</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-4">è¿ç§»åˆ°React Query 4</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>è¿ç§»åˆ°React Query 4</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="ç ´åæ€§æ›´æ”¹">ç ´åæ€§æ›´æ”¹<a class="hash-link" href="#ç ´åæ€§æ›´æ”¹" title="Direct link to heading">â€‹</a></h2><p>ç‰ˆæœ¬ 4 æ˜¯ä¸€æ¬¡å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œå› æ­¤(è‚¯å®š)æœ‰ä¸€äº›ç ´åæ€§çš„æ›´æ”¹å­˜åœ¨ï¼š</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="react-query-åŒ…ç°åœ¨é‡å‘½åä¸º-tanstackreact-query">react-query åŒ…ç°åœ¨é‡å‘½åä¸º @tanstack/react-query<a class="hash-link" href="#react-query-åŒ…ç°åœ¨é‡å‘½åä¸º-tanstackreact-query" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { useQuery } from &#x27;react-query&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { ReactQueryDevtools } from &#x27;react-query/devtools&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { useQuery } from &#x27;@tanstack/react-query&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { ReactQueryDevtools } from &#x27;@tanstack/react-query-devtools&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="codemod">Codemod<a class="hash-link" href="#codemod" title="Direct link to heading">â€‹</a></h4><p>ä¸ºäº†ä½¿è¿ç§»æ›´è½»æ¾ï¼Œv4 é¡ºå¸¦äº†ä¸€ä¸ª codemod</p><blockquote><p>codemod æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å·¥å…·ï¼Œç”¨ä»¥å¸®åŠ©ä½ åœ¨å«æ³¢åæ€§æ›´æ”¹çš„æ›´æ–°ä¹‹é—´è¿›è¡Œè¿ç§»ã€‚ä¸è¿‡è¿˜æ˜¯éœ€è¦è¯·ä½ å½»åº•å®¡æŸ¥ä¸€ä¸‹æ‰€ç”Ÿæˆçš„ä»£ç ï¼
æ­¤å¤–ï¼Œæœ‰äº›è¾ƒä¸ºç½•è§æƒ…å†µæ˜¯ codemod æ— æ³•å‘ç°çš„ï¼Œæ‰€ä»¥è¯·ç•™å¿ƒæ—¥å¿—è¾“å‡ºã€‚</p></blockquote><p>ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è½»æ¾åº”ç”¨ codemod</p><p>å¦‚æœä½ æƒ³é’ˆå¯¹<code>.js</code>æˆ–è€…<code>.jsx</code>æ–‡ä»¶è¿ç§»ï¼š</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npx jscodeshift ./path/to/src/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --extensions=js,jsx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --transform=./node_modules/@tanstack/react-query/codemods/v4/replace-import-specifier.js</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å¦‚æœä½ æƒ³é’ˆå¯¹<code>.ts</code>æˆ–è€…<code>.tsx</code>æ–‡ä»¶è¿ç§»ï¼š</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npx jscodeshift ./path/to/src/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --extensions=ts,tsx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --parser=tsx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --transform=./node_modules/@tanstack/react-query/codemods/v4/replace-import-specifier.js</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è¯·æ³¨æ„åœ¨ä½¿ç”¨<code>Typescript</code>çš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä½¿ç”¨<code>tsx</code>ä½œä¸ºè§£æå™¨ï¼›å¦åˆ™ï¼Œcodemod å°†ä¸èƒ½è¢«æ­£ç¡®åº”ç”¨ï¼</p><p><strong>æ³¨æ„:</strong> åº”ç”¨ codemod å¯èƒ½ä¼šç ´åä½ ä»£ç å·²æœ‰çš„æ ¼å¼ï¼Œæ‰€ä»¥è¯·ä¸è¦å¿˜è®°åœ¨åº”ç”¨ codemod åè¿è¡Œ<code>prettier</code>å’Œ/æˆ–<code>eslint</code>ï¼</p><p><strong>æ³¨æ„:</strong> codemod <em>åªä¼šæ”¹å˜ import çš„å†…å®¹</em>â€”â€”ä½ ä»ç„¶éœ€è¦æ‰‹åŠ¨å®‰è£…ç‹¬ç«‹çš„ devtools è½¯ä»¶åŒ…ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æŸ¥è¯¢é”®å€¼å’Œä¿®æ”¹é”®å€¼ç°åœ¨é»˜è®¤æ˜¯ä¸€ä¸ªæ•°ç»„">æŸ¥è¯¢é”®å€¼ï¼ˆå’Œä¿®æ”¹é”®å€¼ï¼‰ç°åœ¨é»˜è®¤æ˜¯ä¸€ä¸ªæ•°ç»„<a class="hash-link" href="#æŸ¥è¯¢é”®å€¼å’Œä¿®æ”¹é”®å€¼ç°åœ¨é»˜è®¤æ˜¯ä¸€ä¸ªæ•°ç»„" title="Direct link to heading">â€‹</a></h3><p>åœ¨ v3 ä¸­ï¼ŒæŸ¥è¯¢å’Œçªå˜é”®å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–ä¸€ä¸ªæ•°ç»„ã€‚ä½†åœ¨å†…éƒ¨ï¼ŒReact Query ä¸€ç›´éƒ½å°†å…¶è½¬ä¸ºæ•°ç»„ä½¿ç”¨ï¼Œè€Œä¸”æˆ‘ä»¬æœ‰æ—¶ä¼šå°†è¿™ç§æ•°ç»„æš´éœ²ç»™æ¶ˆè´¹è€…ã€‚
ä¾‹å¦‚ï¼Œåœ¨<code>queryFn</code>ä¸­ï¼Œä½ æ€»æ˜¯ä»¥æ•°ç»„çš„å½¢å¼è·å¾—é”®å€¼ã€‚è¿™æ ·ä½¿å¾—ä¸<a href="/react-query-web-i18n/next/guides&amp;concepts/default-query-function">é»˜è®¤æŸ¥è¯¢å‡½æ•°</a>ç»„åˆä½¿ç”¨çš„å·¥ä½œæ›´å®¹æ˜“ã€‚</p><p>ç„¶è€Œï¼Œè¿™ä¸ªæ¦‚å¿µæ²¡æœ‰è¢«è´¯ç©¿åˆ°æ‰€æœ‰çš„ APIs ä¸­ã€‚ä¾‹å¦‚ï¼Œå½“åœ¨<a href="/react-query-web-i18n/next/guides&amp;concepts/filters">æŸ¥è¯¢è¿‡æ»¤å™¨</a>ä¸Šä½¿ç”¨<code>predicate</code>å‡½æ•°æ—¶ï¼Œä½ ä¼šå¾—åˆ°åŸå§‹æŸ¥è¯¢é”®å€¼ï¼ˆå­—ç¬¦ä¸²æˆ–æ•°ç»„ï¼Œè€Œä¸æ˜¯åªæœ‰æ•°ç»„ï¼‰ã€‚å¦‚æœä½ ä½¿ç”¨æ··åˆäº†æ•°ç»„å’Œå­—ç¬¦ä¸²ç»„æˆçš„æŸ¥è¯¢é”®å€¼ï¼Œè¿™ç§å‡½æ•°å°±å˜å¾—éš¾ä»¥ä½¿ç”¨â€”â€”åœ¨ä½¿ç”¨å…¨å±€å›è°ƒæ—¶æƒ…å†µä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>ä¸ºäº†ä½¿å¾— APIs é£æ ¼ç»Ÿä¸€ï¼Œæˆ‘ä»¬å†³å®šé”®å€¼ç»Ÿä¸€ä¸ºæ•°ç»„ï¼š</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> useQuery(&#x27;todos&#x27;, fetchTodos)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> useQuery([&#x27;todos&#x27;], fetchTodos)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="codemod-1">Codemod<a class="hash-link" href="#codemod-1" title="Direct link to heading">â€‹</a></h4><p>åŒæ ·ï¼Œä¸ºäº†å‡å°‘è¿ç§»ä»£ä»·ï¼Œè¿™ä¹Ÿæœ‰å¯¹åº”çš„ codemod</p><blockquote><p>codemod æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å·¥å…·ï¼Œç”¨ä»¥å¸®åŠ©ä½ åœ¨å«æ³¢åæ€§æ›´æ”¹çš„æ›´æ–°ä¹‹é—´è¿›è¡Œè¿ç§»ã€‚ä¸è¿‡è¿˜æ˜¯éœ€è¦è¯·ä½ å½»åº•å®¡æŸ¥ä¸€ä¸‹æ‰€ç”Ÿæˆçš„ä»£ç ï¼
æ­¤å¤–ï¼Œæœ‰äº›è¾ƒä¸ºç½•è§æƒ…å†µæ˜¯ codemod æ— æ³•å‘ç°çš„ï¼Œæ‰€ä»¥è¯·ç•™å¿ƒæ—¥å¿—è¾“å‡ºã€‚</p></blockquote><p>ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è½»æ¾åº”ç”¨ codemod</p><p>å¦‚æœä½ æƒ³é’ˆå¯¹<code>.js</code>æˆ–è€…<code>.jsx</code>æ–‡ä»¶è¿ç§»ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npx jscodeshift ./path/to/src/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --extensions=js,jsx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --transform=./node_modules/@tanstack/react-query/codemods/v4/key-transformation.js</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>å¦‚æœä½ æƒ³é’ˆå¯¹<code>.ts</code>æˆ–è€…<code>.tsx</code>æ–‡ä»¶è¿ç§»ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npx jscodeshift ./path/to/src/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --extensions=ts,tsx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --parser=tsx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --transform=./node_modules/@tanstack/react-query/codemods/v4/key-transformation.js</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è¯·æ³¨æ„åœ¨ä½¿ç”¨<code>Typescript</code>çš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä½¿ç”¨<code>tsx</code>ä½œä¸ºè§£æå™¨ï¼›å¦åˆ™ï¼Œcodemod å°†ä¸èƒ½è¢«æ­£ç¡®åº”ç”¨ï¼</p><p><strong>æ³¨æ„:</strong> åº”ç”¨ codemod å¯èƒ½ä¼šç ´åä½ ä»£ç å·²æœ‰çš„æ ¼å¼ï¼Œæ‰€ä»¥è¯·ä¸è¦å¿˜è®°åœ¨åº”ç”¨ codemod åè¿è¡Œ<code>prettier</code>å’Œ/æˆ–<code>eslint</code>ï¼</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç©ºé—²idleçŠ¶æ€è¢«ç§»é™¤">ç©ºé—²(idle)çŠ¶æ€è¢«ç§»é™¤<a class="hash-link" href="#ç©ºé—²idleçŠ¶æ€è¢«ç§»é™¤" title="Direct link to heading">â€‹</a></h3><p>éšç€æ–°çš„<a href="/react-query-web-i18n/next/guides&amp;concepts/queries#fetchstatus">fetchStatus</a>çš„å¼•å…¥ï¼Œä¸ºäº†æ›´å¥½çš„ç¦»çº¿æ”¯æŒï¼Œç©ºé—²çŠ¶æ€å˜å¾—ä¸é‡è¦äº†ï¼Œå› ä¸º<code>fetchStatus: &#x27;idle&#x27;</code>å·²ç»å¾ˆå¥½åœ°æ•æ‰äº†ç›¸åŒçš„çŠ¶æ€ã€‚
æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯» <a href="/react-query-web-i18n/next/guides&amp;concepts/queries#why-two-different-states">ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªä¸åŒçŠ¶æ€</a>ã€‚</p><p>è¿™å°†ä¸»è¦å½±å“é‚£äº›è¿˜æ²¡æœ‰ä»»ä½•æ•°æ®çš„ç¦ç”¨çŠ¶æ€(disabled)çš„æŸ¥è¯¢ï¼Œå› ä¸ºè¿™äº›æŸ¥è¯¢ä¹‹å‰æ˜¯å¤„äºç©ºé—²(idle)çŠ¶æ€çš„ï¼š</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> status: &#x27;idle&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> status: &#x27;loading&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> fetchStatus: &#x27;idle&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>åŒæ—¶ï¼Œè¯·èŠ±ç‚¹æ—¶é—´é˜…è¯»<a href="/react-query-web-i18n/next/guides&amp;concepts/dependent-queries">æœ‰ä¾èµ–çš„æŸ¥è¯¢</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="usequeriesçš„æ–°çš„-api"><code>useQueries</code>çš„æ–°çš„ API<a class="hash-link" href="#usequeriesçš„æ–°çš„-api" title="Direct link to heading">â€‹</a></h3><p><code>useQueries</code>é’©å­ç°åœ¨æ¥å—ä¸€ä¸ªå¸¦æœ‰<code>queries</code>å‚æ•°(prop)çš„å¯¹è±¡ä½œä¸ºå…¶è¾“å…¥ã€‚<code>queries</code>çš„å€¼æ˜¯ä¸€ä¸ªæŸ¥è¯¢çš„æ•°ç»„ï¼ˆè¿™ä¸ªæ•°ç»„ä¸ v3 ä¸­ä¼ é€’åˆ°<code>useQueries</code>çš„å†…å®¹ç›¸åŒ</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> useQueries([{ queryKey1, queryFn1, options1 }, { queryKey2, queryFn2, options2 }])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> useQueries({ queries: [{ queryKey1, queryFn1, options1 }, { queryKey2, queryFn2, options2 }] })</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¯¹äºæˆåŠŸçš„æŸ¥è¯¢æ¥è¯´-undefined-ç°åœ¨æ˜¯ä¸€ä¸ªéæ³•çš„ç¼“å­˜æ•°æ®">å¯¹äºæˆåŠŸçš„æŸ¥è¯¢æ¥è¯´ï¼Œ Undefined ç°åœ¨æ˜¯ä¸€ä¸ªéæ³•çš„ç¼“å­˜æ•°æ®<a class="hash-link" href="#å¯¹äºæˆåŠŸçš„æŸ¥è¯¢æ¥è¯´-undefined-ç°åœ¨æ˜¯ä¸€ä¸ªéæ³•çš„ç¼“å­˜æ•°æ®" title="Direct link to heading">â€‹</a></h3><p>ä¸ºäº†ä½¿é€šè¿‡è¿”å›<code>undefined</code>æ¥è·³å‡ºæ›´æ–°(bailing out of updates)æˆä¸ºå¯èƒ½ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿<code>undefined</code>æˆä¸ºä¸€ä¸ªéæ³•çš„ç¼“å­˜å€¼ã€‚
è¿™ä¸ React Query çš„å…¶ä»–æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼šä¾‹å¦‚ï¼Œ<a href="/react-query-web-i18n/next/guides&amp;concepts/initial-query-data#initial-data-function">æ¥è‡ªå‡½æ•°çš„åˆå§‹åŒ–çš„æ•°æ®</a>å¦‚æœæ˜¯<code>undefined</code>ï¼Œä¹Ÿå°†<em>ä¸ä¼šè®¾ç½®åˆå§‹çš„æ•°æ®</em>ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨<code>queryFn</code>ä¸­ï¼Œå¦‚æœè¿”å›çš„æ˜¯<code>Promise&lt;void&gt;</code>ï¼Œä½†ä»ç„¶å°è¯•æ‰“å°æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é”™è¯¯ï¼š</p><div class="codeBlockContainer_I0IT language-tsx theme-code-block"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">useQuery</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;key&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  axios</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ç°åœ¨åœ¨<em>é™æ€çš„ç±»å‹æ£€æŸ¥çº§åˆ«ä¸Š</em>å°±ä¸å…è®¸è¿™æ ·åšã€‚åœ¨è¿è¡Œæ—¶ï¼Œ<code>undefined</code>å°†è¢«è½¬åŒ–ä¸ºä¸€ä¸ª<em>è¢«æ‹’ç»çš„ Promise</em>ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä½ å°†å¾—åˆ°ä¸€ä¸ª<code>error</code>ã€‚ï¼ˆä¾¿äºæç¤ºï¼‰åœ¨å¼€å‘æ¨¡å¼ä¸‹å°†ä¼šè¢«æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é»˜è®¤æƒ…å†µä¸‹æŸ¥è¯¢å’Œä¿®æ”¹éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½è¿è¡Œ">é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½è¿è¡Œã€‚<a class="hash-link" href="#é»˜è®¤æƒ…å†µä¸‹æŸ¥è¯¢å’Œä¿®æ”¹éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½è¿è¡Œ" title="Direct link to heading">â€‹</a></h3><p>è¯·é˜…è¯»å…³äº<a href="#%E5%9C%A8%E7%BA%BF%E7%A6%BB%E7%BA%BF%E6%94%AF%E6%8C%81%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BD%E5%85%AC%E5%91%8A">åœ¨çº¿/ç¦»çº¿æ”¯æŒçš„æ–°åŠŸèƒ½å…¬å‘Š</a>ï¼Œä»¥åŠå…³äº<a href="/react-query-web-i18n/next/guides&amp;concepts/network-mode">ç½‘ç»œæ¨¡å¼</a>çš„ä¸“é—¨é¡µé¢</p><p>å°½ç®¡ React Query æ˜¯ä¸€ä¸ªå¼‚æ­¥çŠ¶æ€ç®¡ç†å™¨ï¼Œå¯ä»¥ç”¨äºä»»ä½•äº§ç”Ÿ Promise çš„ä¸œè¥¿ï¼Œä½†å®ƒæœ€å¸¸è¢«ç”¨äºä¸æ•°æ®è·å–åº“ç›¸ç»“åˆçš„æ•°æ®è·å–ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç½‘ç»œè¿æ¥ï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹å°†è¢«&quot;æš‚åœ&quot;ã€‚å¦‚æœä½ æƒ³é€‰æ‹©å›åˆ°ä»¥å‰çš„è¡Œä¸ºï¼Œä½ å¯ä»¥ä¸ºæŸ¥è¯¢å’Œä¿®æ”¹å…¨å±€è®¾ç½®<code>networkMode: offlineFirst</code>ï¼š</p><div class="codeBlockContainer_I0IT language-tsx theme-code-block"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">QueryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultOptions</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    queries</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      networkMode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;offlineFirst&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mutations</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      networkmode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;offlineFirst&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="notifyonchangepropsé€‰é¡¹ä¸å†æ¥å—tracked"><code>notifyOnChangeProps</code>é€‰é¡¹ä¸å†æ¥å—<code>tracked</code><a class="hash-link" href="#notifyonchangepropsé€‰é¡¹ä¸å†æ¥å—tracked" title="Direct link to heading">â€‹</a></h3><p><code>notifyOnChangeProps</code>é€‰é¡¹ä¸å†æ¥å—<code>tracked</code>ã€‚ç›¸åï¼Œ<code>useQuery</code>é»˜è®¤è·Ÿè¸ªå±æ€§æ¥ä¼˜åŒ–æ¸²æŸ“æ¬¡æ•°ã€‚
æ‰€æœ‰ä½¿ç”¨<code>notifyOnChangeProps: &quot;tracked&quot;</code>çš„æŸ¥è¯¢åº”è¯¥é€šè¿‡åˆ é™¤è¿™ä¸ªé€‰é¡¹æ¥æ›´æ–°ã€‚</p><p>å¦‚æœä½ æƒ³åœ¨ä»»ä½•æŸ¥è¯¢ä¸­ç»•è¿‡è¿™ä¸€ç‚¹ï¼Œæ¨¡ä»¿ v3 çš„é»˜è®¤è¡Œä¸ºï¼Œå³æ¯å½“æŸ¥è¯¢å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°æ¸²æŸ“ï¼Œ<code>notifyOnChangeProps</code>ç°åœ¨æ¥å—ä¸€ä¸ª<code>&quot;all&quot;</code>å€¼ï¼Œä»¥é€‰æ‹©ä¸ä½¿ç”¨é»˜è®¤çš„æ™ºèƒ½è·Ÿè¸ªä¼˜åŒ–ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="notifyonchangepropsexclusion-å·²è¢«ç§»é™¤"><code>notifyOnChangePropsExclusion</code> å·²è¢«ç§»é™¤<a class="hash-link" href="#notifyonchangepropsexclusion-å·²è¢«ç§»é™¤" title="Direct link to heading">â€‹</a></h3><p>åœ¨ v4 ä¸­ï¼Œ<code>notifyOnChangeProps</code>é»˜è®¤ä¸º v3 çš„<code>&quot;tracked&quot;</code>è¡Œä¸ºï¼Œè€Œä¸æ˜¯<code>undefined</code>ã€‚ç°åœ¨ï¼Œ<code>&quot;tracked&quot;</code>æ˜¯ v4 çš„é»˜è®¤è¡Œä¸ºï¼Œè¿™ä¸ªé…ç½®é€‰é¡¹ä¸å†æœ‰æ„ä¹‰ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¸ºcancelrefetchæä¾›ä¸€è‡´çš„è¡Œä¸º">ä¸º<code>cancelRefetch</code>æä¾›ä¸€è‡´çš„è¡Œä¸º<a class="hash-link" href="#ä¸ºcancelrefetchæä¾›ä¸€è‡´çš„è¡Œä¸º" title="Direct link to heading">â€‹</a></h3><p><code>cancelRefetch</code>é€‰é¡¹å¯ä»¥è¢«ä¼ é€’ç»™æ‰€æœ‰å¯ä»¥è·å–æŸ¥è¯¢æ•°æ®çš„å‡½æ•°ï¼Œå³ï¼š</p><ul><li><code>queryClient.refetchQueries</code></li><li><code>queryClient.invalidateQueries</code></li><li><code>queryClient.resetQueries</code></li><li><code>useQuery</code>è¿”å›çš„<code>refetch</code></li><li><code>useInfiniteQuery</code>è¿”å›çš„<code>fetchNextPage</code>å’Œ<code>fetchPreviousPage</code></li></ul><p>ï¼ˆä¹‹å‰ï¼‰é™¤äº†<code>fetchNextPage</code>å’Œ<code>fetchPreviousPage</code>ï¼Œè¿™ä¸ªæ ‡å¿—é»˜è®¤éƒ½ä¸º<code>false</code>ã€‚ä½†è¿™æ˜¯ä¸ä¸€è‡´çš„ï¼Œè€Œä¸”æœ‰ä¸€å®šçš„æ½œåœ¨é—®é¢˜ï¼šåœ¨ä¿®æ”¹åè°ƒç”¨<code>refetchQueries</code>æˆ–<code>invalidateQueries</code>å¯èƒ½ä¸ä¼šå¾—åˆ°æœ€æ–°çš„ç»“æœï¼Œå¦‚æœä¹‹å‰çš„æ…¢é€Ÿè·å–å·²ç»åœ¨è¿›è¡Œï¼Œä½†å› ä¸ºè¿™ä¸ªï¼Œé‡æ–°è·å–ä¼šè¢«è·³è¿‡ã€‚</p><p>æˆ‘ä»¬è®¤ä¸ºï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢è¢«ä½ å†™çš„ä¸€äº›ä»£ç ä¸»åŠ¨é‡æ–°è·å–äº†ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåº”è¯¥é‡æ–°è·å–æ•°æ®ã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯¹ä¸Šé¢æåˆ°çš„æ‰€æœ‰æ–¹æ³•ï¼Œ<code>cancelRefetch</code>ç°åœ¨é»˜è®¤éƒ½ä¸º<code>true</code>ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœä½ è¿ç»­åœ°ä¸åŠ ç­‰å¾…åœ°ä¸¤æ¬¡è°ƒç”¨<code>refetchQueries</code>ï¼Œå®ƒç°åœ¨ä¼šå–æ¶ˆç¬¬ä¸€æ¬¡è·å–ï¼Œå¹¶é‡æ–°å¯åŠ¨ç¬¬äºŒæ¬¡ï¼š</p><div class="codeBlockContainer_I0IT language-ts theme-code-block"><div class="codeBlockContent_wNvx ts"><pre tabindex="0" class="prism-code language-ts codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">queryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">refetchQueries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> queryKey</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;todos&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// this will abort the previous refetch and start a new fetch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">queryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">refetchQueries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> queryKey</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;todos&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ä½ å¯ä»¥é€šè¿‡æ˜ç¡®ä¼ é€’<code>cancelRefetch:false</code>æ¥å–æ¶ˆè¿™ä¸€é»˜è®¤è¡Œä¸ºï¼š</p><div class="codeBlockContainer_I0IT language-ts theme-code-block"><div class="codeBlockContent_wNvx ts"><pre tabindex="0" class="prism-code language-ts codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">queryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">refetchQueries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> queryKey</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;todos&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// this will not abort the previous refetch - it will just be ignored</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">queryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">refetchQueries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> queryKey</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;todos&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> cancelRefetch</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>æ³¨æ„ï¼šè‡ªåŠ¨è§¦å‘çš„è·å–è¡Œä¸ºæ²¡æœ‰å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œç”±äºæŸ¥è¯¢åŠ è½½æˆ–åŸºäºçª—å£ç„¦ç‚¹çš„é‡æ–°è·å–ã€‚</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="æŸ¥è¯¢è¿‡æ»¤å™¨">æŸ¥è¯¢è¿‡æ»¤å™¨<a class="hash-link" href="#æŸ¥è¯¢è¿‡æ»¤å™¨" title="Direct link to heading">â€‹</a></h3><p>ä¸€ä¸ª<a href="/react-query-web-i18n/next/guides&amp;concepts/filters">æŸ¥è¯¢è¿‡æ»¤å™¨</a>æ˜¯ä¸€ä¸ªå…·æœ‰æŸäº›æ¡ä»¶çš„å¯¹è±¡ï¼Œä»¥åŒ¹é…æŸ¥è¯¢ã€‚å†å²ä¸Šï¼Œè¿‡æ»¤å™¨é€‰é¡¹å¤§å¤šæ˜¯å¸ƒå°”æ ‡å¿—çš„ç»„åˆã€‚ç„¶è€Œï¼Œç»“åˆè¿™äº›æ ‡å¿—å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸å¯èƒ½çš„çŠ¶æ€ã€‚å…·ä½“æ¥è¯´ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">active?: boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - When set to true it will match active queries.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - When set to false it will match inactive queries.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">inactive?: boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - When set to true it will match inactive queries.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - When set to false it will match active queries.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è¿™äº›æ ‡å¿—åœ¨ä¸€èµ·ä½¿ç”¨æ—¶æ•ˆæœå¹¶ä¸å¥½ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç›¸äº’æ’æ–¥çš„ã€‚ä»æè¿°æ¥çœ‹ï¼Œä¸ºè¿™ä¸¤ä¸ªæ ‡å¿—è®¾ç½®<code>false</code>å¯ä»¥ç†è§£ä¸ºåŒ¹é…æ‰€æœ‰çš„æŸ¥è¯¢ï¼Œæˆ–è€…ä¸åŒ¹é…ä»»ä½•æŸ¥è¯¢â€”â€”è¿™æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚</p><p>åœ¨ v4 ä¸­ï¼Œè¿™äº›é€‰é¡¹è¢«åˆå¹¶ä¸ºä¸€ä¸ªè¿‡æ»¤å™¨é€‰é¡¹ï¼Œä»¥æ›´å¥½åœ°æ˜¾ç¤ºå…¶æ„å›¾ï¼š</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> active?: boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> inactive?: boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> type?: &#x27;active&#x27; | &#x27;inactive&#x27; | &#x27;all&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è¯¥é€‰é¡¹é»˜è®¤ä¸º<code>all</code>ï¼Œä½ å¯ä»¥é€‰æ‹©åªåŒ¹é…<code>active</code>æˆ–<code>inactive</code>çš„æŸ¥è¯¢ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="refetchactive--refetchinactive">refetchActive / refetchInactive<a class="hash-link" href="#refetchactive--refetchinactive" title="Direct link to heading">â€‹</a></h4><p><a href="/react-query-web-i18n/next/reference/QueryClient#queryclientinvalidatequeries">queryClient.invalidateQueries</a> è¿˜æœ‰ä¸¤ä¸ªç±»ä¼¼çš„é€‰é¡¹ï¼š</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">refetchActive: Boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - Defaults to true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - When set to false, queries that match the refetch predicate and are actively being rendered</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    via useQuery and friends will NOT be refetched in the background, and only marked as invalid.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">refetchInactive: Boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - Defaults to false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - When set to true, queries that match the refetch predicate and are not being rendered</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    via useQuery and friends will be both marked as invalid and also refetched in the background</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>åŸºäºåŒæ ·çš„ç†ç”±ï¼Œå®ƒä»¬è¢«æ”¹ä¸ºï¼š</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> active?: boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> inactive?: boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> refetchType?: &#x27;active&#x27; | &#x27;inactive&#x27; | &#x27;all&#x27; | &#x27;none&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>è¿™ä¸ªé€‰é¡¹é»˜è®¤ä¸º<code>active</code>ï¼Œå› ä¸º<code>refetchActive</code>é»˜è®¤ä¸º<code>true</code>ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬è¿˜éœ€è¦ä¸€ç§æ–¹æ³•æ¥å‘Šè¯‰<code>invalidateQueries</code>ï¼Œä½ æ ¹æœ¬ä¸æƒ³è¦é‡æ–°è·å–ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰ç¬¬å››ä¸ªé€‰é¡¹ï¼ˆ<code>none</code>ï¼‰ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="onsuccessä¸å†è¢«setquerydataè°ƒç”¨"><code>onSuccess</code>ä¸å†è¢«<code>setQueryData</code>è°ƒç”¨<a class="hash-link" href="#onsuccessä¸å†è¢«setquerydataè°ƒç”¨" title="Direct link to heading">â€‹</a></h3><p>è¿™æ›¾ç»è®©å¾ˆå¤šäººæ„Ÿåˆ°å›°æƒ‘ã€‚å¦‚æœåœ¨<code>onSuccess</code>ä¸­è°ƒç”¨<code>setQueryData</code>ï¼Œè¿˜ä¼šäº§ç”Ÿæ— é™å¾ªç¯ã€‚å½“ä¸<code>staleTime</code>ç»“åˆæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ¥æºï¼Œå› ä¸ºå¦‚æœåªä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ï¼Œ<em><code>onSuccess</code>ä¸ä¼šè¢«è°ƒç”¨</em>ã€‚</p><p>ä¸<code>onError</code>å’Œ<code>onSettled</code>ç±»ä¼¼ï¼Œ<code>onSuccess</code>çš„å›è°ƒç°åœ¨ä¸è¯·æ±‚çš„æå‡ºç›¸è”ç³»ã€‚æ²¡æœ‰è¯·æ±‚ -&gt; æ²¡æœ‰å›è°ƒã€‚</p><p>å¦‚æœä½ æƒ³ç›‘å¬<code>data</code>å­—æ®µçš„å˜åŒ–ï¼Œä½ æœ€å¥½ç”¨<code>React.useEffect</code>æ¥å®ç°ï¼Œå…¶ä¸­<code>data</code>æ˜¯ä¾èµ–æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚ç”±äº React Query é€šè¿‡ç»“æ„å…±äº«ç¡®ä¿äº†æ•°æ®çš„ç¨³å®šï¼Œæ‰€ä»¥ä¸ä¼šåœ¨æ¯æ¬¡åå°é‡æ–°è·å–éƒ½å»æ‰§è¡Œï¼Œè€Œåªæœ‰åœ¨æ•°æ®ä¸­çš„æŸäº›å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶æ‰æ‰§è¡Œï¼š</p><div class="codeBlockContainer_I0IT language-tsx theme-code-block"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useQuery</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> queryKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> queryFn </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">useEffect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mySideEffectHere</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="persistqueryclientå’Œç›¸åº”çš„æŒä¹…åŒ–æ’ä»¶ä¸å†æ˜¯è¯•éªŒæ€§çš„å·²è¢«é‡æ–°å‘½å"><code>persistQueryClient</code>å’Œç›¸åº”çš„æŒä¹…åŒ–æ’ä»¶ä¸å†æ˜¯è¯•éªŒæ€§çš„ï¼Œå·²è¢«é‡æ–°å‘½å<a class="hash-link" href="#persistqueryclientå’Œç›¸åº”çš„æŒä¹…åŒ–æ’ä»¶ä¸å†æ˜¯è¯•éªŒæ€§çš„å·²è¢«é‡æ–°å‘½å" title="Direct link to heading">â€‹</a></h3><p>æ’ä»¶ <code>createWebStoragePersistor</code> å’Œ <code>createAsyncStoragePersistor</code> åˆ†åˆ«æ›´åä¸º <a href="/react-query-web-i18n/next/plugins/createSyncStoragePersister"><code>createSyncStoragePersister</code></a> å’Œ <a href="/react-query-web-i18n/next/plugins/createAsyncStoragePersister"><code>createAsyncStoragePersister</code></a> ã€‚<code>persistQueryClient</code>ä¸­çš„æ¥å£<code>Persistor</code>ä¹Ÿè¢«é‡æ–°å‘½åä¸º<code>Persister</code>ã€‚è¯·æŸ¥çœ‹<a href="https://english.stackexchange.com/questions/206893/persister-or-persistor" target="_blank" rel="noopener noreferrer">stackexchange ä¸Šçš„é—®é¢˜</a> ä»¥äº†è§£è¿™ä¸€å˜åŒ–çš„åŠ¨æœºã€‚</p><p>ç”±äºè¿™äº›æ’ä»¶ä¸å†æ˜¯å®éªŒæ€§çš„ï¼Œå®ƒä»¬çš„å¯¼å…¥è·¯å¾„ä¹Ÿå·²ç»æ›´æ–°ï¼š</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { persistQueryClient } from &#x27;react-query/persistQueryClient-experimental&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { createWebStoragePersistor } from &#x27;react-query/createWebStoragePersistor-experimental&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { createAsyncStoragePersistor } from &#x27;react-query/createAsyncStoragePersistor-experimental&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { persistQueryClient } from &#x27;@tanstack/react-query-persist-client&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { createSyncStoragePersister } from &#x27;@tanstack/query-sync-storage-persister&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { createAsyncStoragePersister } from &#x27;@tanstack/query-async-storage-persister&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¸å†æ”¯æŒ-promise-ä¸­çš„cancelæ–¹æ³•">ä¸å†æ”¯æŒ Promise ä¸­çš„<code>cancel</code>æ–¹æ³•<a class="hash-link" href="#ä¸å†æ”¯æŒ-promise-ä¸­çš„cancelæ–¹æ³•" title="Direct link to heading">â€‹</a></h3><p>æ—§çš„<a href="/react-query-web-i18n/next/guides&amp;concepts/query-cancellation#old-cancel-function"><code>cancel</code>æ–¹æ³•</a>å…è®¸ä½ åœ¨ Promise ä¸Šå®šä¹‰ä¸€ä¸ª<code>cancel</code>å‡½æ•°ï¼Œç„¶åè¢«åº“ç”¨æ¥æ”¯æŒæŸ¥è¯¢å–æ¶ˆã€‚è¯¥è¡Œä¸ºå·²ç»è¢«åˆ é™¤ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨<a href="/react-query-web-i18n/next/guides&amp;concepts/query-cancellation">è¾ƒæ–°çš„ API</a>ï¼ˆä» ^3.30.0 å¼•å…¥ï¼‰è¿›è¡ŒæŸ¥è¯¢å–æ¶ˆï¼Œå®ƒåœ¨å†…éƒ¨ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" target="_blank" rel="noopener noreferrer"><code>AbortController</code>API</a>å¹¶ä¸ºä½ çš„æŸ¥è¯¢å‡½æ•°æä¾›ä¸€ä¸ª<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal" target="_blank" rel="noopener noreferrer"><code>AbortSignal</code>å®ä¾‹</a>ä»¥æ”¯æŒæŸ¥è¯¢å–æ¶ˆã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="typescript">TypeScript<a class="hash-link" href="#typescript" title="Direct link to heading">â€‹</a></h3><p>ç±»å‹å®šä¹‰ç°ä¾èµ–äº TypeScript v4.1 æˆ–æ›´é«˜</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ”¯æŒçš„æµè§ˆå™¨">æ”¯æŒçš„æµè§ˆå™¨<a class="hash-link" href="#æ”¯æŒçš„æµè§ˆå™¨" title="Direct link to heading">â€‹</a></h3><p>ä» v4 å¼€å§‹ï¼ŒReact Query é’ˆå¯¹ç°ä»£æµè§ˆå™¨è¿›è¡Œäº†ä¼˜åŒ–ã€‚æˆ‘ä»¬å·²ç»æ›´æ–°äº†æˆ‘ä»¬çš„æµè§ˆå™¨åˆ—è¡¨ï¼Œä»¥ç»„åˆä¸ºä¸€ä¸ªæ›´ç°ä»£ã€æ›´é«˜æ€§èƒ½å’Œæ›´å°çš„æ‰“åŒ…æ–‡ä»¶ã€‚ä½ å¯ä»¥é˜…è¯»<a href="/react-query-web-i18n/next/getstarted/installation#requirements">æœ‰å…³è¦æ±‚</a>ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="setlogger-è¢«ç§»é™¤"><code>setLogger</code> è¢«ç§»é™¤<a class="hash-link" href="#setlogger-è¢«ç§»é™¤" title="Direct link to heading">â€‹</a></h3><p>ä¹‹å‰å¯ä»¥é€šè¿‡è°ƒç”¨<code>setLogger</code>æ¥æ”¹å˜å…¨å±€çš„è®°å½•å™¨ã€‚åœ¨ v4 ä¸­ï¼Œå½“åˆ›å»º<code>QueryClient</code>æ—¶ï¼Œè¯¥å‡½æ•°è¢«æ›¿æ¢ä¸ºä¸€ä¸ªå¯é€‰å­—æ®µï¼š</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { QueryClient, setLogger } from &#x27;react-query&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { QueryClient } from &#x27;@tanstack/react-query&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> setLogger(customLogger)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> const queryClient = new QueryClient();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> const queryClient = new QueryClient({ logger: customLogger })</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="æœåŠ¡å™¨ç«¯ä¸å†å…·æœ‰é»˜è®¤çš„æ‰‹åŠ¨åƒåœ¾å›æ”¶manual-garbage-collectionåŠŸèƒ½">æœåŠ¡å™¨ç«¯ä¸å†å…·æœ‰<em>é»˜è®¤çš„</em>æ‰‹åŠ¨åƒåœ¾å›æ”¶(manual Garbage Collection)åŠŸèƒ½<a class="hash-link" href="#æœåŠ¡å™¨ç«¯ä¸å†å…·æœ‰é»˜è®¤çš„æ‰‹åŠ¨åƒåœ¾å›æ”¶manual-garbage-collectionåŠŸèƒ½" title="Direct link to heading">â€‹</a></h3><p>åœ¨ v3 ç‰ˆæœ¬ä¸­ï¼ŒReact Query å°†é»˜è®¤ç¼“å­˜ 5 åˆ†é’Ÿçš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæ‰‹åŠ¨åƒåœ¾å›æ”¶è¿™äº›æ•°æ®ã€‚è¿™ä¸ªé»˜è®¤å€¼ä¹Ÿé€‚ç”¨äºæœåŠ¡å™¨ç«¯çš„ React Queryã€‚</p><p>è¿™å¯¼è‡´äº†é«˜å†…å­˜æ¶ˆè€—å’ŒæŒ‚èµ·è¿›ç¨‹ä»¥ç­‰å¾…æ‰‹åŠ¨åƒåœ¾æ”¶é›†çš„å®Œæˆã€‚åœ¨ v4 ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ç«¯çš„<code>cacheTime</code>ç°åœ¨è¢«è®¾ç½®ä¸º<code>Infinity</code>ï¼Œå…¶æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰‹åŠ¨åƒåœ¾æ”¶é›†ï¼ˆä¸€æ—¦è¯·æ±‚å®Œæˆï¼ŒNodeJS è¿›ç¨‹å°†æ¸…é™¤ä¸€åˆ‡ï¼‰ã€‚</p><p>è¿™ä¸€å˜åŒ–åªå½±å“æœåŠ¡å™¨ç«¯ React Query çš„ç”¨æˆ·ï¼Œä¾‹å¦‚ä½¿ç”¨ Next.jsã€‚å¦‚æœä½ æ­£åœ¨æ‰‹åŠ¨è®¾ç½®<code>cacheTime</code>ï¼Œè¿™å°†ä¸ä¼šå½±å“ä½ ï¼ˆå°½ç®¡ä½ å¯èƒ½æƒ³è¦é•œåƒè¡Œä¸º(mirror behavior)ï¼‰ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—">ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—<a class="hash-link" href="#ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—" title="Direct link to heading">â€‹</a></h3><p>ä» v4 å¼€å§‹ï¼ŒReact Query å°†ä¸å†åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹å‘æ§åˆ¶å°è®°å½•é”™è¯¯ï¼ˆä¾‹å¦‚å¤±è´¥çš„è·å–ï¼‰ï¼Œå› ä¸ºè¿™è®©å¾ˆå¤šäººæ„Ÿåˆ°å›°æƒ‘ã€‚å½“ç„¶ï¼Œå¼€å‘æ¨¡å¼ä¸‹é”™è¯¯ä»ç„¶ä¼šæ˜¾ç¤ºã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="esm-æ”¯æŒ">ESM æ”¯æŒ<a class="hash-link" href="#esm-æ”¯æŒ" title="Direct link to heading">â€‹</a></h3><p>React Query ç°åœ¨æ”¯æŒ <a href="https://nodejs.org/api/packages.html#exports" target="_blank" rel="noopener noreferrer">package.json <code>&quot;exports&quot;</code></a>ï¼Œå¹¶ä¸”å®Œå…¨å…¼å®¹ Node å¯¹ CommonJS å’Œ ESM çš„æœ¬åœ°è§£æã€‚æˆ‘ä»¬ä¸å¸Œæœ›è¿™å¯¹ä½ æ¥è¯´æ˜¯ä¸€ä¸ªç ´åæ€§çš„å˜åŒ–ï¼Œä½†è¿™ç¡®å®é™åˆ¶äº†ä½ å¯ä»¥å¯¼å…¥ä½ çš„é¡¹ç›®çš„æ–‡ä»¶â€”â€”æœ‰ä¸”åªæœ‰æˆ‘ä»¬æ­£å¼æ”¯æŒçš„å…¥å£ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç²¾ç®€çš„-notifyevents">ç²¾ç®€çš„ NotifyEvents<a class="hash-link" href="#ç²¾ç®€çš„-notifyevents" title="Direct link to heading">â€‹</a></h3><p>ä¹‹å‰æ‰‹åŠ¨è®¢é˜…<code>QueryCache</code>æ€»æ˜¯ç»™ä½ ä¸€ä¸ª<code>QueryCacheNotifyEvent</code>ï¼Œä½†å¯¹<code>MutationCache</code>æ¥è¯´åº”è¯¥ä¸æ˜¯è¿™æ ·çš„ã€‚æˆ‘ä»¬å·²ç»ç®€åŒ–äº†è¡Œä¸ºï¼Œä¹Ÿç›¸åº”åœ°è°ƒæ•´äº†äº‹ä»¶åç§°ã€‚</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="querycachenotifyevent">QueryCacheNotifyEvent<a class="hash-link" href="#querycachenotifyevent" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> type: &#x27;queryAdded&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> type: &#x27;added&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> type: &#x27;queryRemoved&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> type: &#x27;removed&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> type: &#x27;queryUpdated&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> type: &#x27;updated&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="mutationcachenotifyevent">MutationCacheNotifyEvent<a class="hash-link" href="#mutationcachenotifyevent" title="Direct link to heading">â€‹</a></h4><p><code>MutationCacheNotifyEvent</code>ä¸<code>QueryCacheNotifyEvent</code>çš„ç±»å‹ç›¸åŒã€‚</p><blockquote><p>æ³¨æ„ï¼šåªæœ‰å½“ä½ é€šè¿‡<code>queryCache.subscribe</code>æˆ–<code>mutationCache.subscribe</code>æ‰‹åŠ¨è®¢é˜…ç¼“å­˜æ—¶ï¼Œè¿™æ‰æœ‰æ„ä¹‰ã€‚</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="å–æ¶ˆäº†å•ç‹¬å¯¼å‡ºçš„-hydration">å–æ¶ˆäº†å•ç‹¬å¯¼å‡ºçš„ hydration<a class="hash-link" href="#å–æ¶ˆäº†å•ç‹¬å¯¼å‡ºçš„-hydration" title="Direct link to heading">â€‹</a></h3><p>åœ¨<a href="https://github.com/tannerlinsley/react-query/releases/tag/v3.22.0" target="_blank" rel="noopener noreferrer">3.22.0</a>ç‰ˆæœ¬ä¸­ï¼Œhydration è¢«ç§»å…¥ React Query çš„æ ¸å¿ƒã€‚åœ¨ v3 ç‰ˆæœ¬ä¸­ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨<code>react-query/hydration</code>çš„æ—§å¯¼å‡ºï¼Œä½†è¿™äº›å·²ç»åœ¨ v4 ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { dehydrate, hydrate, useHydrate, Hydrate } from &#x27;react-query/hydration&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { dehydrate, hydrate, useHydrate, Hydrate } from &#x27;@tanstack/react-query&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä»queryclientqueryå’Œmutationä¸­åˆ é™¤äº†æ— æ–‡æ¡£è®°è½½çš„æ–¹æ³•">ä»<code>queryClient</code>ã€<code>query</code>å’Œ<code>mutation</code>ä¸­åˆ é™¤äº†æ— æ–‡æ¡£è®°è½½çš„æ–¹æ³•ã€‚<a class="hash-link" href="#ä»queryclientqueryå’Œmutationä¸­åˆ é™¤äº†æ— æ–‡æ¡£è®°è½½çš„æ–¹æ³•" title="Direct link to heading">â€‹</a></h3><p>åœ¨<code>QueryClient</code>ä¸Šçš„<code>cancelMutatations</code>å’Œ<code>executeMutation</code>æ–¹æ³•æ˜¯æ²¡æœ‰æ–‡æ¡£çš„ï¼Œè€Œä¸”åœ¨å†…éƒ¨æ²¡æœ‰ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ é™¤äº†å®ƒä»¬ã€‚ç”±äºå®ƒåªæ˜¯å¯¹<code>mutationCache</code>ä¸Šçš„ä¸€ä¸ªæ–¹æ³•çš„å°è£…ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨<code>executeMutation</code>çš„åŠŸèƒ½ã€‚</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> executeMutation&lt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">   TData = unknown,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">   TError = unknown,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">   TVariables = void,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">   TContext = unknown</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> &gt;(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">   options: MutationOptions&lt;TData, TError, TVariables, TContext&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> ): Promise&lt;TData&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">   return this.mutationCache.build(this, options).execute()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>æ­¤å¤–ï¼Œ<code>query.setDefaultOptions</code>è¢«åˆ é™¤ï¼Œå› ä¸ºå®ƒä¹Ÿæ²¡æœ‰è¢«ä½¿ç”¨ã€‚<code>mutation.cancel</code>è¢«åˆ é™¤ï¼Œå› ä¸ºå®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰å–æ¶ˆå‘å‡ºçš„è¯·æ±‚ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="srcreactç›®å½•è¢«é‡æ–°å‘½åä¸ºsrcreactjs"><code>src/react</code>ç›®å½•è¢«é‡æ–°å‘½åä¸º<code>src/reactjs</code><a class="hash-link" href="#srcreactç›®å½•è¢«é‡æ–°å‘½åä¸ºsrcreactjs" title="Direct link to heading">â€‹</a></h3><p>ä»¥å‰ï¼ŒReact Query æœ‰ä¸€ä¸ªåä¸ºä»<code>react</code>æ¨¡å—å¯¼å…¥çš„<code>react</code>çš„ç›®å½•ã€‚è¿™å¯èƒ½ä¼šç»™ä¸€äº› Jest é…ç½®å¸¦æ¥é—®é¢˜ï¼Œå¯¼è‡´åœ¨è¿è¡Œæµ‹è¯•æ—¶å‡ºç°é”™è¯¯ï¼Œæ¯”å¦‚ã€‚</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">TypeError: Cannot read property &#x27;createContext&#x27; of undefined</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>éšç€ç›®å½•çš„é‡æ–°å‘½åï¼Œè¿™ä¸å†æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p><p>å¦‚æœä½ åœ¨ä½ çš„é¡¹ç›®ä¸­ç›´æ¥ä»<code>&#x27;react-query/react&#x27;</code>å¯¼å…¥äº†ä»»ä½•ä¸œè¥¿ï¼ˆè€Œä¸æ˜¯åªæœ‰<code>react-query</code>ï¼‰ï¼Œé‚£ä¹ˆä½ éœ€è¦æ›´æ–°ä½ çš„å¯¼å…¥ã€‚</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"> import { QueryClientProvider } from &#x27;react-query/react&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> import { QueryClientProvider } from &#x27;react-query/reactjs&#x27;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="æ–°åŠŸèƒ½-">æ–°åŠŸèƒ½ ğŸš€<a class="hash-link" href="#æ–°åŠŸèƒ½-" title="Direct link to heading">â€‹</a></h2><p>v4 å¸¦æœ‰ä¸€å¥—ä»¤äººèµå¹çš„æ–°åŠŸèƒ½ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="æ”¯æŒ-react-18">æ”¯æŒ React 18<a class="hash-link" href="#æ”¯æŒ-react-18" title="Direct link to heading">â€‹</a></h3><p>React 18 åœ¨ä»Šå¹´æ—©äº›æ—¶å€™å‘å¸ƒï¼Œv4 ç°åœ¨å¯¹å®ƒå’Œå®ƒå¸¦æ¥çš„æ–°å¹¶å‘åŠŸèƒ½æœ‰ç€ä¸€æµçš„æ”¯æŒã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="åœ¨çº¿ç¦»çº¿æ”¯æŒçš„æ–°åŠŸèƒ½å…¬å‘Š">åœ¨çº¿/ç¦»çº¿æ”¯æŒçš„æ–°åŠŸèƒ½å…¬å‘Š<a class="hash-link" href="#åœ¨çº¿ç¦»çº¿æ”¯æŒçš„æ–°åŠŸèƒ½å…¬å‘Š" title="Direct link to heading">â€‹</a></h3><p>åœ¨ V3 ä¸­ï¼ŒReact Query æ€»æ˜¯æ‰§è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹ï¼Œä½†éšåé‡‡ç”¨çš„å‡è®¾æ˜¯ï¼šå¦‚æœä½ æƒ³é‡è¯•ï¼Œä½ éœ€è¦è¿æ¥åˆ°äº’è”ç½‘ã€‚è¿™å¯¼è‡´äº†ä¸€äº›ä»¤äººå›°æƒ‘çš„æƒ…å†µï¼š</p><ul><li>ä½ åœ¨ç¦»çº¿çŠ¶æ€ä¸‹åŠ è½½ä¸€ä¸ªæŸ¥è¯¢--å®ƒè¿›å…¥äº†åŠ è½½çŠ¶æ€ï¼Œè¯·æ±‚å¤±è´¥äº†ï¼Œè€Œä¸”å®ƒä¸€ç›´å¤„äºåŠ è½½çŠ¶æ€ï¼Œç›´åˆ°ä½ å†æ¬¡ä¸Šç½‘ï¼Œå°½ç®¡å®ƒå¹¶æ²¡æœ‰è¢«çœŸæ­£çš„è·å–ã€‚</li><li>åŒæ ·åœ°ï¼Œå¦‚æœä½ æ˜¯ç¦»çº¿çŠ¶æ€ï¼Œå¹¶ä¸”å…³é—­äº†é‡è¯•ï¼Œä½ çš„æŸ¥è¯¢å°†åªä¼šæ‰§è¡Œå¹¶å¤±è´¥ï¼Œå¹¶ä¸”æŸ¥è¯¢ä¼šè¿›å…¥é”™è¯¯çŠ¶æ€ã€‚</li><li>ä½ åœ¨ç¦»çº¿çŠ¶æ€ä¸‹ï¼Œæƒ³å¯åŠ¨ä¸€ä¸ªä¸ä¸€å®šéœ€è¦ç½‘ç»œè¿æ¥çš„æŸ¥è¯¢ï¼ˆå› ä¸ºä½ <em>å¯ä»¥</em>ä½¿ç”¨ React Query åšæ•°æ®è·å–ä»¥å¤–çš„äº‹æƒ…ï¼‰ï¼Œä½†ç”±äºå…¶ä»–åŸå› è€Œå¤±è´¥ã€‚è¯¥æŸ¥è¯¢ç°åœ¨å°†è¢«æš‚åœï¼Œç›´åˆ°ä½ å†æ¬¡ä¸Šçº¿ã€‚</li><li>å¦‚æœä½ æ˜¯ç¦»çº¿çš„ï¼ŒåŸºäºçª—å£ç„¦ç‚¹çš„é‡æ–°è·å–æ ¹æœ¬å°±æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚</li></ul><p>åœ¨ v4 ä¸­ï¼ŒReact Query å¼•å…¥äº†ä¸€ä¸ªæ–°çš„<code>networkMode</code>æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚è¯·é˜…è¯»å…³äºæ–°çš„<a href="/react-query-web-i18n/next/guides&amp;concepts/network-mode">ç½‘ç»œæ¨¡å¼</a>çš„ä¸“é—¨é¡µé¢äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="é»˜è®¤æƒ…å†µä¸‹çš„è·Ÿè¸ªæŸ¥è¯¢">é»˜è®¤æƒ…å†µä¸‹çš„è·Ÿè¸ªæŸ¥è¯¢<a class="hash-link" href="#é»˜è®¤æƒ…å†µä¸‹çš„è·Ÿè¸ªæŸ¥è¯¢" title="Direct link to heading">â€‹</a></h3><p>React Query é»˜è®¤ä¸º&quot;è·Ÿè¸ª&quot;æŸ¥è¯¢å±æ€§ï¼Œè¿™åº”è¯¥ä¼šç»™ä½ çš„æ¸²æŸ“æ€§èƒ½å¸¦æ¥å¾ˆå¤§çš„æå‡ã€‚è¯¥åŠŸèƒ½ä»<a href="https://github.com/tannerlinsley/react-query/releases/tag/v3.6.0" target="_blank" rel="noopener noreferrer">v3.6.0</a>å¼€å§‹å­˜åœ¨ï¼Œç°åœ¨å·²ç»æˆä¸º v4 çš„é»˜è®¤è¡Œä¸ºã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ç”¨-setquerydata-è·³å‡ºæ›´æ–°bail-out-of-the-update">ç”¨ setQueryData è·³å‡ºæ›´æ–°(bail out of the update)<a class="hash-link" href="#ç”¨-setquerydata-è·³å‡ºæ›´æ–°bail-out-of-the-update" title="Direct link to heading">â€‹</a></h3><p>å½“ä½¿ç”¨<a href="/react-query-web-i18n/next/reference/QueryClient#queryclientsetquerydata">setQueryData åŠŸèƒ½çš„æ›´æ–°å½¢å¼</a>æ—¶ï¼Œä½ ç°åœ¨å¯ä»¥é€šè¿‡è¿”å›<code>undefined</code>æ¥è·³å‡ºæ›´æ–°ã€‚å¦‚æœ<code>undefined</code>æ˜¯ä½œä¸º<code>previousValue</code>æä¾›ç»™ä½ çš„ï¼Œè¿™æ„å‘³ç€ç›®å‰æ²¡æœ‰ç¼“å­˜æ¡ç›®å­˜åœ¨ï¼Œä½ ä¸æƒ³/ä¸èƒ½åˆ›å»ºä¸€ä¸ªï¼Œå°±åƒåœ¨åˆ‡æ¢ todo çš„ä¾‹å­ä¸­ä¸€æ ·ï¼Œè¿™å¾ˆæœ‰å¸®åŠ©ï¼š</p><div class="codeBlockContainer_I0IT language-tsx theme-code-block"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">queryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setQueryData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;todo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">previousTodo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  previousTodo </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain">previousTodo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> done</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="ä¿®æ”¹çš„ç¼“å­˜åŠå…¶åƒåœ¾å›æ”¶">ä¿®æ”¹çš„ç¼“å­˜åŠå…¶åƒåœ¾å›æ”¶<a class="hash-link" href="#ä¿®æ”¹çš„ç¼“å­˜åŠå…¶åƒåœ¾å›æ”¶" title="Direct link to heading">â€‹</a></h3><p>ä¿®æ”¹ç°åœ¨ä¹Ÿå¯ä»¥åƒæŸ¥è¯¢ä¸€æ ·ï¼Œè‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶ã€‚é»˜è®¤çš„<code>cacheTime</code>ä¹Ÿè¢«è®¾ç½®ä¸º 5 åˆ†é’Ÿã€‚</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="å¤šä¸ª-providers-çš„è‡ªå®šä¹‰ä¸Šä¸‹æ–‡">å¤šä¸ª Providers çš„è‡ªå®šä¹‰ä¸Šä¸‹æ–‡<a class="hash-link" href="#å¤šä¸ª-providers-çš„è‡ªå®šä¹‰ä¸Šä¸‹æ–‡" title="Direct link to heading">â€‹</a></h3><p>ç°åœ¨å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰ä¸Šä¸‹æ–‡ï¼Œå°†é’©å­ä¸å®ƒä»¬åŒ¹é…çš„<code>Provider</code>é…å¯¹ã€‚å½“ç»„ä»¶æ ‘ä¸­å¯èƒ½æœ‰å¤šä¸ª React Query <code>Provider</code>å®ä¾‹ï¼Œè€Œä½ éœ€è¦ç¡®ä¿ä½ çš„é’©å­ä½¿ç”¨æ­£ç¡®çš„<code>Provider</code>å®ä¾‹æ—¶ï¼Œè¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚</p><p>ä¾‹å­:</p><ol><li>ä¸€ä¸ªæ•°æ®å±•ç¤ºé¡µé¢</li></ol><div class="codeBlockContainer_I0IT language-tsx theme-code-block"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Our first data package: @my-scope/container-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> context </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">createContext</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">QueryClient</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">undefined</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> queryClient </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">QueryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">useUser</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useQuery</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">USER_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">USER_FETCHER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">ContainerDataProvider</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  children</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  children</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">ReactNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">QueryClientProvider</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">client</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">queryClient</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">context</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">context</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">children</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">QueryClientProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="2"><li>åˆ›å»ºå¦ä¸€ä¸ªæ•°æ®å±•ç¤ºé¡µé¢</li></ol><div class="codeBlockContainer_I0IT language-tsx theme-code-block"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Our second data package: @my-scope/my-component-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> context </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">createContext</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token maybe-class-name">QueryClient</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">undefined</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> queryClient </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">QueryClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">useItems</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useQuery</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">ITEMS_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">ITEMS_FETCHER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">MyComponentDataProvider</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  children</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  children</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">ReactNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">QueryClientProvider</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">client</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">queryClient</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">context</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">context</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">children</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">QueryClientProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="3"><li>ä½¿ç”¨è¿™ä¸¤ä¸ªé¡µé¢</li></ol><div class="codeBlockContainer_I0IT language-tsx theme-code-block"><div class="codeBlockContent_wNvx tsx"><pre tabindex="0" class="prism-code language-tsx codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Our application</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">ContainerDataProvider</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> useUser </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@my-scope/container-data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">AppDataProvider</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@my-scope/app-data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">MyComponentDataProvider</span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token imports"> useItems </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;@my-scope/my-component-data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">ContainerDataProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"> // &lt;-- Provides container data (like &quot;user&quot;) using its own React Query provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">AppDataProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"> // &lt;-- Provides app data using its own React Query provider (unused in this example)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">MyComponentDataProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"> // &lt;-- Provides component data (like &quot;items&quot;) using its own React Query provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">MyComponent</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">MyComponentDataProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">AppDataProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain-text"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">ContainerDataProvider</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Example of hooks provided by the &quot;DataProvider&quot; components above:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">MyComponent</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> user </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useUser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// &lt;-- Uses the context specified in ContainerDataProvider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> items </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useItems</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// &lt;-- Uses the context specified in MyComponentDataProvider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/react-query-web-i18n/next/tags/ç¿»è¯‘å®Œæˆ">ç¿»è¯‘å®Œæˆ</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/cangSDARM/react-query-web-i18n/docs/guides&amp;concepts/migrating-to-react-query-4.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-08-29T15:56:16.000Z">8/29/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/react-query-web-i18n/next/guides&amp;concepts/migrating-to-react-query-3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">è¿ç§»åˆ°React Query 3</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/react-query-web-i18n/next/plugins/broadcastQueryClient"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">broadcastQueryClient (Experimental)</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ç ´åæ€§æ›´æ”¹" class="table-of-contents__link toc-highlight">ç ´åæ€§æ›´æ”¹</a><ul><li><a href="#react-query-åŒ…ç°åœ¨é‡å‘½åä¸º-tanstackreact-query" class="table-of-contents__link toc-highlight">react-query åŒ…ç°åœ¨é‡å‘½åä¸º @tanstack/react-query</a></li><li><a href="#æŸ¥è¯¢é”®å€¼å’Œä¿®æ”¹é”®å€¼ç°åœ¨é»˜è®¤æ˜¯ä¸€ä¸ªæ•°ç»„" class="table-of-contents__link toc-highlight">æŸ¥è¯¢é”®å€¼ï¼ˆå’Œä¿®æ”¹é”®å€¼ï¼‰ç°åœ¨é»˜è®¤æ˜¯ä¸€ä¸ªæ•°ç»„</a></li><li><a href="#ç©ºé—²idleçŠ¶æ€è¢«ç§»é™¤" class="table-of-contents__link toc-highlight">ç©ºé—²(idle)çŠ¶æ€è¢«ç§»é™¤</a></li><li><a href="#usequeriesçš„æ–°çš„-api" class="table-of-contents__link toc-highlight"><code>useQueries</code>çš„æ–°çš„ API</a></li><li><a href="#å¯¹äºæˆåŠŸçš„æŸ¥è¯¢æ¥è¯´-undefined-ç°åœ¨æ˜¯ä¸€ä¸ªéæ³•çš„ç¼“å­˜æ•°æ®" class="table-of-contents__link toc-highlight">å¯¹äºæˆåŠŸçš„æŸ¥è¯¢æ¥è¯´ï¼Œ Undefined ç°åœ¨æ˜¯ä¸€ä¸ªéæ³•çš„ç¼“å­˜æ•°æ®</a></li><li><a href="#é»˜è®¤æƒ…å†µä¸‹æŸ¥è¯¢å’Œä¿®æ”¹éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½è¿è¡Œ" class="table-of-contents__link toc-highlight">é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹éœ€è¦ç½‘ç»œè¿æ¥æ‰èƒ½è¿è¡Œã€‚</a></li><li><a href="#notifyonchangepropsé€‰é¡¹ä¸å†æ¥å—tracked" class="table-of-contents__link toc-highlight"><code>notifyOnChangeProps</code>é€‰é¡¹ä¸å†æ¥å—<code>tracked</code></a></li><li><a href="#notifyonchangepropsexclusion-å·²è¢«ç§»é™¤" class="table-of-contents__link toc-highlight"><code>notifyOnChangePropsExclusion</code> å·²è¢«ç§»é™¤</a></li><li><a href="#ä¸ºcancelrefetchæä¾›ä¸€è‡´çš„è¡Œä¸º" class="table-of-contents__link toc-highlight">ä¸º<code>cancelRefetch</code>æä¾›ä¸€è‡´çš„è¡Œä¸º</a></li><li><a href="#æŸ¥è¯¢è¿‡æ»¤å™¨" class="table-of-contents__link toc-highlight">æŸ¥è¯¢è¿‡æ»¤å™¨</a></li><li><a href="#onsuccessä¸å†è¢«setquerydataè°ƒç”¨" class="table-of-contents__link toc-highlight"><code>onSuccess</code>ä¸å†è¢«<code>setQueryData</code>è°ƒç”¨</a></li><li><a href="#persistqueryclientå’Œç›¸åº”çš„æŒä¹…åŒ–æ’ä»¶ä¸å†æ˜¯è¯•éªŒæ€§çš„å·²è¢«é‡æ–°å‘½å" class="table-of-contents__link toc-highlight"><code>persistQueryClient</code>å’Œç›¸åº”çš„æŒä¹…åŒ–æ’ä»¶ä¸å†æ˜¯è¯•éªŒæ€§çš„ï¼Œå·²è¢«é‡æ–°å‘½å</a></li><li><a href="#ä¸å†æ”¯æŒ-promise-ä¸­çš„cancelæ–¹æ³•" class="table-of-contents__link toc-highlight">ä¸å†æ”¯æŒ Promise ä¸­çš„<code>cancel</code>æ–¹æ³•</a></li><li><a href="#typescript" class="table-of-contents__link toc-highlight">TypeScript</a></li><li><a href="#æ”¯æŒçš„æµè§ˆå™¨" class="table-of-contents__link toc-highlight">æ”¯æŒçš„æµè§ˆå™¨</a></li><li><a href="#setlogger-è¢«ç§»é™¤" class="table-of-contents__link toc-highlight"><code>setLogger</code> è¢«ç§»é™¤</a></li><li><a href="#æœåŠ¡å™¨ç«¯ä¸å†å…·æœ‰é»˜è®¤çš„æ‰‹åŠ¨åƒåœ¾å›æ”¶manual-garbage-collectionåŠŸèƒ½" class="table-of-contents__link toc-highlight">æœåŠ¡å™¨ç«¯ä¸å†å…·æœ‰<em>é»˜è®¤çš„</em>æ‰‹åŠ¨åƒåœ¾å›æ”¶(manual Garbage Collection)åŠŸèƒ½</a></li><li><a href="#ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—" class="table-of-contents__link toc-highlight">ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—</a></li><li><a href="#esm-æ”¯æŒ" class="table-of-contents__link toc-highlight">ESM æ”¯æŒ</a></li><li><a href="#ç²¾ç®€çš„-notifyevents" class="table-of-contents__link toc-highlight">ç²¾ç®€çš„ NotifyEvents</a></li><li><a href="#å–æ¶ˆäº†å•ç‹¬å¯¼å‡ºçš„-hydration" class="table-of-contents__link toc-highlight">å–æ¶ˆäº†å•ç‹¬å¯¼å‡ºçš„ hydration</a></li><li><a href="#ä»queryclientqueryå’Œmutationä¸­åˆ é™¤äº†æ— æ–‡æ¡£è®°è½½çš„æ–¹æ³•" class="table-of-contents__link toc-highlight">ä»<code>queryClient</code>ã€<code>query</code>å’Œ<code>mutation</code>ä¸­åˆ é™¤äº†æ— æ–‡æ¡£è®°è½½çš„æ–¹æ³•ã€‚</a></li><li><a href="#srcreactç›®å½•è¢«é‡æ–°å‘½åä¸ºsrcreactjs" class="table-of-contents__link toc-highlight"><code>src/react</code>ç›®å½•è¢«é‡æ–°å‘½åä¸º<code>src/reactjs</code></a></li></ul></li><li><a href="#æ–°åŠŸèƒ½-" class="table-of-contents__link toc-highlight">æ–°åŠŸèƒ½ ğŸš€</a><ul><li><a href="#æ”¯æŒ-react-18" class="table-of-contents__link toc-highlight">æ”¯æŒ React 18</a></li><li><a href="#åœ¨çº¿ç¦»çº¿æ”¯æŒçš„æ–°åŠŸèƒ½å…¬å‘Š" class="table-of-contents__link toc-highlight">åœ¨çº¿/ç¦»çº¿æ”¯æŒçš„æ–°åŠŸèƒ½å…¬å‘Š</a></li><li><a href="#é»˜è®¤æƒ…å†µä¸‹çš„è·Ÿè¸ªæŸ¥è¯¢" class="table-of-contents__link toc-highlight">é»˜è®¤æƒ…å†µä¸‹çš„è·Ÿè¸ªæŸ¥è¯¢</a></li><li><a href="#ç”¨-setquerydata-è·³å‡ºæ›´æ–°bail-out-of-the-update" class="table-of-contents__link toc-highlight">ç”¨ setQueryData è·³å‡ºæ›´æ–°(bail out of the update)</a></li><li><a href="#ä¿®æ”¹çš„ç¼“å­˜åŠå…¶åƒåœ¾å›æ”¶" class="table-of-contents__link toc-highlight">ä¿®æ”¹çš„ç¼“å­˜åŠå…¶åƒåœ¾å›æ”¶</a></li><li><a href="#å¤šä¸ª-providers-çš„è‡ªå®šä¹‰ä¸Šä¸‹æ–‡" class="table-of-contents__link toc-highlight">å¤šä¸ª Providers çš„è‡ªå®šä¹‰ä¸Šä¸‹æ–‡</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Web Community.</div></div></div></footer></div>
<script src="/react-query-web-i18n/assets/js/runtime~main.911b33c8.js"></script>
<script src="/react-query-web-i18n/assets/js/main.7cbfae2a.js"></script>
</body>
</html>